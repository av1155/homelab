name: CI - Validate Docker Compose & YAML

on:
    push:
        branches: ["main"]
    pull_request:
        branches: ["main"]

jobs:
    validate:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repo
              uses: actions/checkout@v4

            # Install dependencies
            - name: Install Docker
              uses: docker/setup-buildx-action@v3

            - name: Install yamllint
              run: sudo apt-get update && sudo apt-get install -y yamllint

            # Check YAML formatting
            - name: Lint YAML files
              run: yamllint .

            # Validate docker-compose files
            - name: Validate Docker Compose files
              run: |
                  find stacks -name "docker-compose.yaml" -print0 | while IFS= read -r -d '' file; do
                    echo "Validating $file"
                    docker compose -f "$file" config >/dev/null
                  done
